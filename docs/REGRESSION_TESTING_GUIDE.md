# ğŸ“‹ å›æ­¸æ¸¬è©¦å®Œæ•´æŒ‡å—

## ç›®éŒ„
- [ä»€éº¼æ˜¯å›æ­¸æ¸¬è©¦](#ä»€éº¼æ˜¯å›æ­¸æ¸¬è©¦)
- [å›æ­¸æ¸¬è©¦çš„é‡è¦æ€§](#å›æ­¸æ¸¬è©¦çš„é‡è¦æ€§)
- [è¨­è¨ˆåŸå‰‡](#è¨­è¨ˆåŸå‰‡)
- [æ¸¬è©¦é¡å‹èˆ‡å±¤ç´š](#æ¸¬è©¦é¡å‹èˆ‡å±¤ç´š)
- [ç·¨å¯«æ­¥é©Ÿ](#ç·¨å¯«æ­¥é©Ÿ)
- [å¯¦éš›æ¡ˆä¾‹](#å¯¦éš›æ¡ˆä¾‹)
- [å·¥å…·èˆ‡è‡ªå‹•åŒ–](#å·¥å…·èˆ‡è‡ªå‹•åŒ–)
- [æœ€ä½³å¯¦è¸](#æœ€ä½³å¯¦è¸)
- [å¸¸è¦‹é™·é˜±](#å¸¸è¦‹é™·é˜±)

---

## ä»€éº¼æ˜¯å›æ­¸æ¸¬è©¦ï¼Ÿ

**å›æ­¸æ¸¬è©¦ (Regression Testing)** æ˜¯ä¸€ç¨®è»Ÿé«”æ¸¬è©¦æŠ€è¡“ï¼Œç”¨æ–¼ç¢ºä¿è»Ÿé«”çš„ä¿®æ”¹ï¼ˆå¦‚æ–°åŠŸèƒ½ã€Bug ä¿®å¾©ã€ç¨‹å¼ç¢¼é‡æ§‹ï¼‰ä¸æœƒç ´å£ç¾æœ‰çš„æ­£å¸¸åŠŸèƒ½ã€‚

### ğŸ¯ æ ¸å¿ƒç›®æ¨™

1. **é©—è­‰ç¾æœ‰åŠŸèƒ½**: ç¢ºä¿ä¿®æ”¹å¾ŒåŸæœ‰åŠŸèƒ½ä»ç„¶æ­£å¸¸å·¥ä½œ
2. **æ—©æœŸç™¼ç¾å•é¡Œ**: åœ¨éƒ¨ç½²å‰ç™¼ç¾å›æ­¸éŒ¯èª¤
3. **å»ºç«‹ä¿¡å¿ƒ**: è®“é–‹ç™¼è€…æ”¾å¿ƒé€²è¡Œä¿®æ”¹
4. **é™ä½é¢¨éšª**: æ¸›å°‘ç”Ÿç”¢ç’°å¢ƒä¸­çš„æ„å¤–æ•…éšœ

### ğŸ”„ ä½•æ™‚éœ€è¦å›æ­¸æ¸¬è©¦ï¼Ÿ

- ä¿®å¾© Bug å¾Œ
- æ·»åŠ æ–°åŠŸèƒ½å¾Œ
- é‡æ§‹ä»£ç¢¼å¾Œ
- å‡ç´šä¾è³´åº«å¾Œ
- ä¿®æ”¹é…ç½®æ–‡ä»¶å¾Œ
- éƒ¨ç½²åˆ°æ–°ç’°å¢ƒå‰

---

## å›æ­¸æ¸¬è©¦çš„é‡è¦æ€§

### ğŸ’¥ æ²’æœ‰å›æ­¸æ¸¬è©¦çš„é¢¨éšª

```
é–‹ç™¼è€…è¦–è§’: "æˆ‘åªä¿®æ”¹äº†ç™»å…¥åŠŸèƒ½ï¼Œå…¶ä»–æ‡‰è©²æ²’å•é¡Œ"
å¯¦éš›æƒ…æ³: ç™»å…¥ä¿®æ”¹å½±éŸ¿äº†ç”¨æˆ¶æœƒè©±ï¼Œå°è‡´è³¼ç‰©è»ŠåŠŸèƒ½å¤±æ•ˆ
çµæœ: ç”¨æˆ¶ç„¡æ³•å®Œæˆè³¼è²·ï¼Œæ¥­å‹™æå¤±
```

### âœ… æœ‰å›æ­¸æ¸¬è©¦çš„å¥½è™•

1. **æ—©æœŸç™¼ç¾**: åœ¨é–‹ç™¼éšæ®µå°±ç™¼ç¾å•é¡Œ
2. **ç¯€çœæˆæœ¬**: æ—©æœŸä¿®å¾©æ¯”ç”Ÿç”¢ä¿®å¾©æˆæœ¬ä½ 100 å€
3. **æé«˜å“è³ª**: ç³»çµ±æ•´é«”ç©©å®šæ€§æå‡
4. **åŠ é€Ÿé–‹ç™¼**: é–‹ç™¼è€…å¯ä»¥å¤§è†½é‡æ§‹å’Œå„ªåŒ–

---

## è¨­è¨ˆåŸå‰‡

### 1. **é¢¨éšªé©…å‹•åŸå‰‡**

å„ªå…ˆæ¸¬è©¦é«˜é¢¨éšªã€é«˜å½±éŸ¿çš„åŠŸèƒ½ï¼š

```bash
é«˜å„ªå…ˆç´š:
- æ ¸å¿ƒæ¥­å‹™æµç¨‹ (ç”¨æˆ¶è¨»å†Šã€ç™»å…¥ã€ä»˜æ¬¾)
- æ•¸æ“šå®Œæ•´æ€§ (æ•¸æ“šåº«æ“ä½œã€æ–‡ä»¶è™•ç†)
- å®‰å…¨ç›¸é—œåŠŸèƒ½ (èªè­‰ã€æˆæ¬Šã€åŠ å¯†)

ä¸­å„ªå…ˆç´š:
- å¸¸ç”¨åŠŸèƒ½ (æœç´¢ã€ç€è¦½ã€è¨­å®š)
- æ•´åˆåŠŸèƒ½ (API èª¿ç”¨ã€ç¬¬ä¸‰æ–¹æœå‹™)

ä½å„ªå…ˆç´š:
- UI ç¾åŒ–
- éé—œéµæç¤ºè¨Šæ¯
```

### 2. **é‡‘å­—å¡”åŸå‰‡**

```
               ğŸ”º E2E æ¸¬è©¦ (å°‘é‡)
              /   \
             /     \  æ•´åˆæ¸¬è©¦ (é©ä¸­)
            /       \
           /         \
          /           \
         /_____________\
         å–®å…ƒæ¸¬è©¦ (å¤§é‡)
```

### 3. **å¿«é€Ÿåé¥‹åŸå‰‡**

- **å¿«é€ŸåŸ·è¡Œ**: æ¸¬è©¦æ‡‰è©²åœ¨åˆç†æ™‚é–“å…§å®Œæˆ
- **å¿«é€Ÿå¤±æ•—**: ä¸€æ—¦ç™¼ç¾å•é¡Œç«‹å³åœæ­¢ä¸¦å ±å‘Š
- **æ¸…æ™°è¼¸å‡º**: æ¸¬è©¦çµæœæ‡‰è©²æ˜“æ–¼ç†è§£

### 4. **ç¨ç«‹æ€§åŸå‰‡**

- æ¸¬è©¦ä¹‹é–“ä¸æ‡‰è©²ç›¸äº’ä¾è³´
- æ¸¬è©¦æ‡‰è©²å¯ä»¥å–®ç¨åŸ·è¡Œ
- æ¸¬è©¦é †åºä¸æ‡‰è©²å½±éŸ¿çµæœ

---

## æ¸¬è©¦é¡å‹èˆ‡å±¤ç´š

### ğŸ§© å–®å…ƒå›æ­¸æ¸¬è©¦

**ç›®æ¨™**: é©—è­‰å€‹åˆ¥å‡½æ•¸æˆ–é¡åˆ¥çš„åŠŸèƒ½

```python
# ç¯„ä¾‹: æ¸¬è©¦è¨ˆç®—å‡½æ•¸
def test_calculate_total_regression():
    """å›æ­¸æ¸¬è©¦: ç¢ºä¿ç¸½åƒ¹è¨ˆç®—åŠŸèƒ½æ­£å¸¸"""
    # åŸºæœ¬æƒ…æ³
    assert calculate_total([10, 20, 30]) == 60
    
    # é‚Šç•Œæƒ…æ³
    assert calculate_total([]) == 0
    assert calculate_total([0]) == 0
    
    # è² æ•¸æƒ…æ³ (å¦‚æœå…è¨±)
    assert calculate_total([-10, 20]) == 10
    
    # æµ®é»æ•¸ç²¾åº¦
    assert abs(calculate_total([0.1, 0.2]) - 0.3) < 0.0001
```

### ğŸ”— æ•´åˆå›æ­¸æ¸¬è©¦

**ç›®æ¨™**: é©—è­‰æ¨¡çµ„é–“çš„äº¤äº’åŠŸèƒ½

```python
def test_user_registration_integration():
    """æ•´åˆå›æ­¸æ¸¬è©¦: ç”¨æˆ¶è¨»å†Šæµç¨‹"""
    # 1. æº–å‚™æ¸¬è©¦æ•¸æ“š
    user_data = {
        'username': 'test_user',
        'email': 'test@example.com',
        'password': 'SecurePass123'
    }
    
    # 2. åŸ·è¡Œè¨»å†Š
    response = register_user(user_data)
    
    # 3. é©—è­‰çµæœ
    assert response.status_code == 201
    assert 'user_id' in response.data
    
    # 4. é©—è­‰æ•¸æ“šåº«ç‹€æ…‹
    user = get_user_by_email('test@example.com')
    assert user is not None
    assert user.username == 'test_user'
    
    # 5. é©—è­‰å‰¯ä½œç”¨ (å¦‚æ­¡è¿éƒµä»¶)
    assert email_was_sent('test@example.com', 'welcome')
    
    # 6. æ¸…ç†æ¸¬è©¦æ•¸æ“š
    delete_user(user.id)
```

### ğŸŒ ç«¯åˆ°ç«¯å›æ­¸æ¸¬è©¦

**ç›®æ¨™**: é©—è­‰å®Œæ•´çš„ç”¨æˆ¶æµç¨‹

```python
def test_complete_purchase_flow():
    """ç«¯åˆ°ç«¯å›æ­¸æ¸¬è©¦: å®Œæ•´è³¼è²·æµç¨‹"""
    
    # æ­¥é©Ÿ 1: ç”¨æˆ¶ç™»å…¥
    login_response = login_user('customer@test.com', 'password')
    assert login_response.success
    
    # æ­¥é©Ÿ 2: ç€è¦½å•†å“
    products = get_products(category='electronics')
    assert len(products) > 0
    
    # æ­¥é©Ÿ 3: æ·»åŠ åˆ°è³¼ç‰©è»Š
    cart_response = add_to_cart(products[0].id, quantity=2)
    assert cart_response.success
    
    # æ­¥é©Ÿ 4: çµå¸³
    checkout_response = checkout(payment_method='credit_card')
    assert checkout_response.success
    
    # æ­¥é©Ÿ 5: é©—è­‰è¨‚å–®
    order = get_order(checkout_response.order_id)
    assert order.status == 'confirmed'
    assert order.total > 0
    
    # æ­¥é©Ÿ 6: é©—è­‰åº«å­˜æ›´æ–°
    updated_product = get_product(products[0].id)
    assert updated_product.stock == products[0].stock - 2
```

---

## ç·¨å¯«æ­¥é©Ÿ

### ç¬¬ä¸€æ­¥: åˆ†æç³»çµ±æ¶æ§‹

```
1. è­˜åˆ¥æ ¸å¿ƒçµ„ä»¶:
   - ç”¨æˆ¶ç®¡ç†ç³»çµ±
   - æ•¸æ“šå­˜å„²å±¤
   - æ¥­å‹™é‚è¼¯å±¤
   - API æ¥å£å±¤
   - ç¬¬ä¸‰æ–¹æ•´åˆ

2. è­˜åˆ¥é—œéµæµç¨‹:
   - ç”¨æˆ¶è¨»å†Š/ç™»å…¥
   - æ•¸æ“š CRUD æ“ä½œ
   - æ”¯ä»˜è™•ç†
   - é€šçŸ¥ç³»çµ±

3. è­˜åˆ¥é¢¨éšªé»:
   - å¤šç·šç¨‹æ“ä½œ
   - æ•¸æ“šåº«äº‹å‹™
   - å¤–éƒ¨ API èª¿ç”¨
   - ç·©å­˜æ©Ÿåˆ¶
```

### ç¬¬äºŒæ­¥: å»ºç«‹æ¸¬è©¦æ¸…å–®

```markdown
## æ ¸å¿ƒåŠŸèƒ½æ¸¬è©¦æ¸…å–®

### ç”¨æˆ¶ç®¡ç†
- [ ] ç”¨æˆ¶è¨»å†ŠåŠŸèƒ½
- [ ] ç”¨æˆ¶ç™»å…¥åŠŸèƒ½
- [ ] å¯†ç¢¼é‡ç½®åŠŸèƒ½
- [ ] ç”¨æˆ¶è³‡æ–™æ›´æ–°

### æ•¸æ“šæ“ä½œ
- [ ] æ•¸æ“šå‰µå»º
- [ ] æ•¸æ“šè®€å–
- [ ] æ•¸æ“šæ›´æ–°
- [ ] æ•¸æ“šåˆªé™¤

### ç³»çµ±æ•´åˆ
- [ ] æ•¸æ“šåº«é€£æ¥
- [ ] å¿«å–æœå‹™
- [ ] ç¬¬ä¸‰æ–¹ API
- [ ] æ–‡ä»¶è™•ç†
```

### ç¬¬ä¸‰æ­¥: è¨­è¨ˆæ¸¬è©¦æ¡ˆä¾‹

```python
# æ¸¬è©¦æ¡ˆä¾‹æ¨¡æ¿
def test_[åŠŸèƒ½åç¨±]_regression():
    """
    å›æ­¸æ¸¬è©¦: [åŠŸèƒ½æè¿°]
    
    æ¸¬è©¦ç›®æ¨™: ç¢ºä¿ [å…·é«”åŠŸèƒ½] åœ¨ä¿®æ”¹å¾Œä»ç„¶æ­£å¸¸å·¥ä½œ
    å‰ç½®æ¢ä»¶: [éœ€è¦çš„ç’°å¢ƒæˆ–æ•¸æ“šæº–å‚™]
    æ¸¬è©¦æ­¥é©Ÿ: [è©³ç´°çš„åŸ·è¡Œæ­¥é©Ÿ]
    é æœŸçµæœ: [æœŸæœ›çš„æ¸¬è©¦çµæœ]
    """
    
    # 1. æº–å‚™éšæ®µ (Arrange)
    # è¨­ç½®æ¸¬è©¦ç’°å¢ƒã€æº–å‚™æ¸¬è©¦æ•¸æ“š
    
    # 2. åŸ·è¡Œéšæ®µ (Act)  
    # åŸ·è¡Œè¢«æ¸¬è©¦çš„åŠŸèƒ½
    
    # 3. é©—è­‰éšæ®µ (Assert)
    # æª¢æŸ¥çµæœæ˜¯å¦ç¬¦åˆé æœŸ
    
    # 4. æ¸…ç†éšæ®µ (Cleanup)
    # æ¸…ç†æ¸¬è©¦æ•¸æ“šï¼Œæ¢å¾©ç’°å¢ƒ
```

### ç¬¬å››æ­¥: å¯¦ç¾æ¸¬è©¦è‡ªå‹•åŒ–

```bash
#!/bin/bash
# regression_test_suite.sh

echo "ğŸ§ª é–‹å§‹åŸ·è¡Œå›æ­¸æ¸¬è©¦å¥—ä»¶..."

# è¨­ç½®æ¸¬è©¦ç’°å¢ƒ
setup_test_environment() {
    echo "ğŸ”§ è¨­ç½®æ¸¬è©¦ç’°å¢ƒ..."
    # å•Ÿå‹•æ¸¬è©¦æ•¸æ“šåº«
    # æ¸…ç†èˆŠæ•¸æ“š
    # è¼‰å…¥æ¸¬è©¦æ•¸æ“š
}

# åŸ·è¡Œå–®å…ƒæ¸¬è©¦
run_unit_tests() {
    echo "ğŸ“‹ åŸ·è¡Œå–®å…ƒæ¸¬è©¦..."
    pytest tests/unit/ -v --tb=short
}

# åŸ·è¡Œæ•´åˆæ¸¬è©¦
run_integration_tests() {
    echo "ğŸ”— åŸ·è¡Œæ•´åˆæ¸¬è©¦..."
    pytest tests/integration/ -v --tb=short
}

# åŸ·è¡Œç«¯åˆ°ç«¯æ¸¬è©¦
run_e2e_tests() {
    echo "ğŸŒ åŸ·è¡Œç«¯åˆ°ç«¯æ¸¬è©¦..."
    pytest tests/e2e/ -v --tb=short
}

# æ¸…ç†æ¸¬è©¦ç’°å¢ƒ
cleanup_test_environment() {
    echo "ğŸ§¹ æ¸…ç†æ¸¬è©¦ç’°å¢ƒ..."
    # åœæ­¢æ¸¬è©¦æœå‹™
    # æ¸…ç†æ¸¬è©¦æ•¸æ“š
}

# ä¸»åŸ·è¡Œæµç¨‹
main() {
    setup_test_environment
    
    # å¦‚æœä»»ä½•æ¸¬è©¦å¤±æ•—ï¼Œç«‹å³åœæ­¢
    run_unit_tests || exit 1
    run_integration_tests || exit 1
    run_e2e_tests || exit 1
    
    cleanup_test_environment
    echo "âœ… æ‰€æœ‰å›æ­¸æ¸¬è©¦é€šéï¼"
}

main "$@"
```

---

## å¯¦éš›æ¡ˆä¾‹

### æ¡ˆä¾‹ä¸€: RAG ç³»çµ±å›æ­¸æ¸¬è©¦

åŸºæ–¼æˆ‘å€‘çš„ RAG é …ç›®ï¼Œè®“æˆ‘å€‘è¨­è¨ˆå®Œæ•´çš„å›æ­¸æ¸¬è©¦ï¼š

```python
# tests/regression/test_rag_system_regression.py

import pytest
import sys
import os
from pathlib import Path

# æ·»åŠ é …ç›®è·¯å¾‘
sys.path.append(str(Path(__file__).parent.parent.parent))

class TestRAGSystemRegression:
    """RAG ç³»çµ±å›æ­¸æ¸¬è©¦å¥—ä»¶"""
    
    @pytest.fixture(autouse=True)
    def setup_and_teardown(self):
        """æ¯å€‹æ¸¬è©¦çš„è¨­ç½®å’Œæ¸…ç†"""
        # è¨­ç½®éšæ®µ
        self.test_documents = []
        yield
        # æ¸…ç†éšæ®µ
        for doc_id in self.test_documents:
            try:
                self.rag_system.delete_document(doc_id)
            except:
                pass
    
    def test_system_initialization_regression(self):
        """å›æ­¸æ¸¬è©¦: ç³»çµ±åˆå§‹åŒ–åŠŸèƒ½"""
        from src.rag_system.elasticsearch_rag_system import ElasticsearchRAGSystem
        
        # æ¸¬è©¦ç³»çµ±å¯ä»¥æ­£å¸¸åˆå§‹åŒ–
        rag_system = ElasticsearchRAGSystem()
        self.rag_system = rag_system
        
        # é©—è­‰é—œéµå±¬æ€§å­˜åœ¨
        assert hasattr(rag_system, 'elasticsearch_client')
        assert hasattr(rag_system, 'memory_stats')
        assert hasattr(rag_system, 'system_status')
        
        # é©—è­‰ Elasticsearch é€£æ¥
        assert rag_system.elasticsearch_client.ping()
        
        # é©—è­‰åŸºæœ¬åŠŸèƒ½å¯ç”¨
        stats = rag_system.get_document_statistics()
        assert isinstance(stats, dict)
        assert 'total_documents' in stats
    
    def test_document_upload_regression(self):
        """å›æ­¸æ¸¬è©¦: æ–‡æª”ä¸Šå‚³åŠŸèƒ½"""
        # æº–å‚™æ¸¬è©¦æ–‡æª”
        test_content = "é€™æ˜¯ä¸€å€‹æ¸¬è©¦æ–‡æª”ï¼Œç”¨æ–¼é©—è­‰ä¸Šå‚³åŠŸèƒ½ã€‚"
        
        # ä¸Šå‚³æ–‡æª”
        doc_id = self.rag_system.add_document(
            content=test_content,
            metadata={'source': 'regression_test', 'type': 'test'}
        )
        self.test_documents.append(doc_id)
        
        # é©—è­‰æ–‡æª”å·²ä¸Šå‚³
        stats = self.rag_system.get_document_statistics()
        assert stats['total_documents'] > 0
        
        # é©—è­‰å¯ä»¥æª¢ç´¢åˆ°æ–‡æª”
        results = self.rag_system.query("æ¸¬è©¦æ–‡æª”")
        assert len(results) > 0
        assert any(test_content in str(result) for result in results)
    
    def test_query_functionality_regression(self):
        """å›æ­¸æ¸¬è©¦: æŸ¥è©¢åŠŸèƒ½"""
        # å…ˆä¸Šå‚³ä¸€äº›æ¸¬è©¦æ–‡æª”
        test_docs = [
            "Python æ˜¯ä¸€ç¨®ç¨‹å¼èªè¨€",
            "æ©Ÿå™¨å­¸ç¿’æ˜¯äººå·¥æ™ºæ…§çš„åˆ†æ”¯",
            "Elasticsearch æ˜¯æœå°‹å¼•æ“"
        ]
        
        for doc in test_docs:
            doc_id = self.rag_system.add_document(content=doc)
            self.test_documents.append(doc_id)
        
        # ç­‰å¾…ç´¢å¼•æ›´æ–°
        import time
        time.sleep(2)
        
        # æ¸¬è©¦å„ç¨®æŸ¥è©¢
        queries = [
            ("Python", "ç¨‹å¼èªè¨€"),
            ("æ©Ÿå™¨å­¸ç¿’", "äººå·¥æ™ºæ…§"),
            ("Elasticsearch", "æœå°‹å¼•æ“")
        ]
        
        for query, expected_term in queries:
            results = self.rag_system.query(query)
            assert len(results) > 0, f"æŸ¥è©¢ '{query}' æ²’æœ‰è¿”å›çµæœ"
            
            # é©—è­‰çµæœç›¸é—œæ€§
            found_relevant = any(
                expected_term in str(result) for result in results
            )
            assert found_relevant, f"æŸ¥è©¢ '{query}' æ²’æœ‰è¿”å›ç›¸é—œçµæœ"
    
    def test_memory_stats_regression(self):
        """å›æ­¸æ¸¬è©¦: è¨˜æ†¶é«”çµ±è¨ˆåŠŸèƒ½"""
        # ç²å–åˆå§‹ç‹€æ…‹
        initial_stats = self.rag_system.memory_stats.copy()
        
        # åŸ·è¡Œä¸€äº›æ“ä½œ
        doc_id = self.rag_system.add_document("æ¸¬è©¦è¨˜æ†¶é«”çµ±è¨ˆ")
        self.test_documents.append(doc_id)
        
        # é©—è­‰çµ±è¨ˆæ›´æ–°
        updated_stats = self.rag_system.memory_stats
        assert isinstance(updated_stats, dict)
        assert 'documents_processed' in updated_stats
        assert 'vectors_stored' in updated_stats
        assert 'peak_memory_mb' in updated_stats
    
    def test_error_handling_regression(self):
        """å›æ­¸æ¸¬è©¦: éŒ¯èª¤è™•ç†åŠŸèƒ½"""
        # æ¸¬è©¦ç„¡æ•ˆè¼¸å…¥çš„è™•ç†
        try:
            self.rag_system.query("")  # ç©ºæŸ¥è©¢
            self.rag_system.query(None)  # None æŸ¥è©¢
        except Exception as e:
            # æ‡‰è©²å„ªé›…åœ°è™•ç†éŒ¯èª¤ï¼Œè€Œä¸æ˜¯å´©æ½°
            assert "æŸ¥è©¢ä¸èƒ½ç‚ºç©º" in str(e) or "invalid query" in str(e).lower()
        
        # æ¸¬è©¦å¤§é‡æ•¸æ“šçš„è™•ç†
        large_content = "æ¸¬è©¦ " * 10000
        try:
            doc_id = self.rag_system.add_document(large_content)
            self.test_documents.append(doc_id)
            # æ‡‰è©²èƒ½æ­£å¸¸è™•ç†ï¼Œæˆ–çµ¦å‡ºåˆç†çš„éŒ¯èª¤è¨Šæ¯
        except Exception as e:
            assert "too large" in str(e).lower() or "æ–‡æª”éå¤§" in str(e)

# æ•ˆèƒ½å›æ­¸æ¸¬è©¦
class TestPerformanceRegression:
    """æ•ˆèƒ½å›æ­¸æ¸¬è©¦"""
    
    def test_query_response_time_regression(self):
        """å›æ­¸æ¸¬è©¦: æŸ¥è©¢å›æ‡‰æ™‚é–“"""
        import time
        
        rag_system = ElasticsearchRAGSystem()
        
        # åŸ·è¡Œå¤šæ¬¡æŸ¥è©¢ä¸¦æ¸¬é‡æ™‚é–“
        query_times = []
        for i in range(5):
            start_time = time.time()
            results = rag_system.query("æ¸¬è©¦æŸ¥è©¢")
            end_time = time.time()
            query_times.append(end_time - start_time)
        
        # é©—è­‰å¹³å‡å›æ‡‰æ™‚é–“åœ¨å¯æ¥å—ç¯„åœå…§
        avg_time = sum(query_times) / len(query_times)
        assert avg_time < 5.0, f"æŸ¥è©¢å›æ‡‰æ™‚é–“éé•·: {avg_time:.2f}ç§’"
        
        # é©—è­‰æ™‚é–“ç©©å®šæ€§ (æ¨™æº–å·®ä¸æ‡‰éå¤§)
        import statistics
        std_dev = statistics.stdev(query_times)
        assert std_dev < 2.0, f"æŸ¥è©¢æ™‚é–“ä¸ç©©å®š: æ¨™æº–å·® {std_dev:.2f}"
```

### æ¡ˆä¾‹äºŒ: API å›æ­¸æ¸¬è©¦

```python
# tests/regression/test_api_regression.py

import requests
import pytest

class TestAPIRegression:
    """API å›æ­¸æ¸¬è©¦"""
    
    BASE_URL = "http://localhost:8002"
    
    def test_health_endpoint_regression(self):
        """å›æ­¸æ¸¬è©¦: å¥åº·æª¢æŸ¥ç«¯é»"""
        response = requests.get(f"{self.BASE_URL}/health")
        
        # é©—è­‰ç‹€æ…‹ç¢¼
        assert response.status_code == 200
        
        # é©—è­‰å›æ‡‰æ ¼å¼
        data = response.json()
        assert 'status' in data
        assert data['status'] == 'healthy'
        
        # é©—è­‰å›æ‡‰æ™‚é–“
        assert response.elapsed.total_seconds() < 1.0
    
    def test_query_api_regression(self):
        """å›æ­¸æ¸¬è©¦: æŸ¥è©¢ API"""
        query_data = {
            "query": "ä»€éº¼æ˜¯æ©Ÿå™¨å­¸ç¿’ï¼Ÿ",
            "top_k": 5
        }
        
        response = requests.post(
            f"{self.BASE_URL}/query",
            json=query_data
        )
        
        assert response.status_code == 200
        
        data = response.json()
        assert 'results' in data
        assert 'response_time' in data
        assert isinstance(data['results'], list)
        assert len(data['results']) <= 5
```

---

## å·¥å…·èˆ‡è‡ªå‹•åŒ–

### ğŸ› ï¸ æ¸¬è©¦æ¡†æ¶é¸æ“‡

#### Python ç”Ÿæ…‹ç³»çµ±
```bash
# pytest - åŠŸèƒ½å¼·å¤§ã€æ˜“æ–¼ä½¿ç”¨
pip install pytest pytest-cov pytest-html

# åŸ·è¡Œæ¸¬è©¦
pytest tests/ -v --cov=src --html=report.html
```

#### JavaScript ç”Ÿæ…‹ç³»çµ±
```bash
# Jest - React/Node.js æ¨™æº–
npm install --save-dev jest

# Cypress - E2E æ¸¬è©¦
npm install --save-dev cypress
```

#### é€šç”¨å·¥å…·
```bash
# Docker - ç’°å¢ƒä¸€è‡´æ€§
docker-compose -f docker-compose.test.yml up

# GitHub Actions - CI/CD æ•´åˆ
# è¦‹ä¸‹æ–¹ YAML ç¯„ä¾‹
```

### ğŸ”„ CI/CD æ•´åˆ

```yaml
# .github/workflows/regression-tests.yml
name: Regression Tests

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

jobs:
  regression-tests:
    runs-on: ubuntu-latest
    
    services:
      elasticsearch:
        image: elasticsearch:8.15.0
        env:
          discovery.type: single-node
          xpack.security.enabled: false
        ports:
          - 9200:9200
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Set up Python
      uses: actions/setup-python@v3
      with:
        python-version: '3.9'
    
    - name: Install dependencies
      run: |
        pip install -r requirements.txt
        pip install pytest pytest-cov
    
    - name: Wait for Elasticsearch
      run: |
        for i in {1..30}; do
          curl -s http://localhost:9200 && break
          sleep 2
        done
    
    - name: Run regression tests
      run: |
        export ELASTICSEARCH_URL=http://localhost:9200
        pytest tests/regression/ -v --cov=src
    
    - name: Upload coverage
      uses: codecov/codecov-action@v3
```

### ğŸ“Š æ¸¬è©¦å ±å‘Š

```python
# conftest.py - pytest é…ç½®
import pytest
import json
import time

@pytest.fixture(autouse=True)
def test_timing():
    """è¨˜éŒ„æ¯å€‹æ¸¬è©¦çš„åŸ·è¡Œæ™‚é–“"""
    start_time = time.time()
    yield
    duration = time.time() - start_time
    
    # è¨˜éŒ„åˆ°å ±å‘Šæ–‡ä»¶
    with open('test_timing.json', 'a') as f:
        json.dump({
            'test': pytest.current_item.name,
            'duration': duration,
            'timestamp': time.time()
        }, f)
        f.write('\n')

@pytest.hookimpl(tryfirst=True)
def pytest_runtest_makereport(item, call):
    """è‡ªå®šç¾©æ¸¬è©¦å ±å‘Š"""
    if call.when == "call":
        # è¨˜éŒ„å¤±æ•—çš„æ¸¬è©¦
        if call.excinfo is not None:
            print(f"âŒ æ¸¬è©¦å¤±æ•—: {item.name}")
            print(f"éŒ¯èª¤: {call.excinfo.value}")
        else:
            print(f"âœ… æ¸¬è©¦é€šé: {item.name}")
```

---

## æœ€ä½³å¯¦è¸

### 1. **æ¸¬è©¦æ•¸æ“šç®¡ç†**

```python
# ä½¿ç”¨å·¥å» æ¨¡å¼å‰µå»ºæ¸¬è©¦æ•¸æ“š
class TestDataFactory:
    @staticmethod
    def create_user(email="test@example.com", **kwargs):
        return {
            'username': f'user_{int(time.time())}',
            'email': email,
            'password': 'TestPass123',
            **kwargs
        }
    
    @staticmethod
    def create_document(content="æ¸¬è©¦å…§å®¹", **kwargs):
        return {
            'content': content,
            'metadata': {
                'source': 'test',
                'timestamp': time.time(),
                **kwargs.get('metadata', {})
            }
        }

# ä½¿ç”¨
def test_user_creation():
    user_data = TestDataFactory.create_user(email="unique@test.com")
    user = create_user(user_data)
    assert user.email == "unique@test.com"
```

### 2. **ç’°å¢ƒéš”é›¢**

```python
# ä½¿ç”¨æ¸¬è©¦ç‰¹å®šçš„é…ç½®
class TestConfig:
    TESTING = True
    DATABASE_URL = "sqlite:///:memory:"
    ELASTICSEARCH_URL = "http://localhost:9201"  # æ¸¬è©¦ç”¨ ES
    CACHE_TYPE = "simple"

# åœ¨æ¸¬è©¦ä¸­ä½¿ç”¨
@pytest.fixture(autouse=True)
def use_test_config():
    original_config = app.config
    app.config.from_object(TestConfig)
    yield
    app.config = original_config
```

### 3. **æ¨¡æ“¬å¤–éƒ¨ä¾è³´**

```python
# ä½¿ç”¨ mock é¿å…çœŸå¯¦çš„å¤–éƒ¨èª¿ç”¨
from unittest.mock import patch, MagicMock

def test_email_notification_regression():
    with patch('email_service.send_email') as mock_send:
        mock_send.return_value = True
        
        # åŸ·è¡Œæ¸¬è©¦
        result = send_welcome_email('user@test.com')
        
        # é©—è­‰èª¿ç”¨
        assert result is True
        mock_send.assert_called_once_with(
            to='user@test.com',
            subject='æ­¡è¿åŠ å…¥',
            template='welcome'
        )
```

### 4. **æ¸¬è©¦è¦†è“‹ç‡ç›£æ§**

```python
# pytest.ini
[tool:pytest]
addopts = 
    --cov=src
    --cov-report=html:htmlcov
    --cov-report=term-missing
    --cov-fail-under=80
    -v

# ç¢ºä¿æ ¸å¿ƒåŠŸèƒ½ 100% è¦†è“‹
[coverage:run]
source = src

[coverage:report]
exclude_lines =
    pragma: no cover
    def __repr__
    raise AssertionError
    raise NotImplementedError
```

---

## å¸¸è¦‹é™·é˜±

### âŒ é™·é˜±ä¸€ï¼šéåº¦ä¾è³´æ‰‹å‹•æ¸¬è©¦

```python
# ä¸å¥½çš„åšæ³• - éœ€è¦æ‰‹å‹•é©—è­‰
def test_user_interface():
    """é€™å€‹æ¸¬è©¦éœ€è¦äººå·¥æª¢æŸ¥è¢å¹•"""
    render_page('/dashboard')
    print("è«‹æª¢æŸ¥é é¢æ˜¯å¦é¡¯ç¤ºæ­£ç¢º")
    assert True  # å¯¦éš›ä¸Šä»€éº¼éƒ½æ²’æ¸¬è©¦

# å¥½çš„åšæ³• - è‡ªå‹•åŒ–é©—è­‰
def test_dashboard_content():
    response = client.get('/dashboard')
    assert response.status_code == 200
    assert 'æ­¡è¿' in response.data.decode()
    assert 'user-stats' in response.data.decode()
```

### âŒ é™·é˜±äºŒï¼šæ¸¬è©¦é–“ç›¸äº’ä¾è³´

```python
# ä¸å¥½çš„åšæ³• - æ¸¬è©¦ä¾è³´é †åº
class TestUserWorkflow:
    user_id = None
    
    def test_1_create_user(self):
        user = create_user({'email': 'test@example.com'})
        TestUserWorkflow.user_id = user.id
        assert user.id is not None
    
    def test_2_update_user(self):
        # ä¾è³´å‰ä¸€å€‹æ¸¬è©¦çš„çµæœ
        update_user(TestUserWorkflow.user_id, {'name': 'Updated'})
        assert True

# å¥½çš„åšæ³• - æ¯å€‹æ¸¬è©¦ç¨ç«‹
class TestUserWorkflow:
    
    @pytest.fixture
    def test_user(self):
        user = create_user({'email': 'test@example.com'})
        yield user
        delete_user(user.id)
    
    def test_create_user(self):
        user = create_user({'email': 'test@example.com'})
        assert user.id is not None
        delete_user(user.id)
    
    def test_update_user(self, test_user):
        update_user(test_user.id, {'name': 'Updated'})
        updated_user = get_user(test_user.id)
        assert updated_user.name == 'Updated'
```

### âŒ é™·é˜±ä¸‰ï¼šå¿½ç•¥æ€§èƒ½å›æ­¸

```python
# ä¸å¥½çš„åšæ³• - åªæ¸¬è©¦åŠŸèƒ½æ­£ç¢ºæ€§
def test_search_function():
    results = search('query')
    assert len(results) > 0

# å¥½çš„åšæ³• - åŒæ™‚é—œæ³¨æ€§èƒ½
def test_search_function_with_performance():
    import time
    
    start_time = time.time()
    results = search('query')
    duration = time.time() - start_time
    
    # åŠŸèƒ½æ­£ç¢ºæ€§
    assert len(results) > 0
    
    # æ€§èƒ½è¦æ±‚
    assert duration < 2.0, f"æœç´¢è€—æ™‚éé•·: {duration:.2f}ç§’"
```

### âŒ é™·é˜±å››ï¼šæ¸¬è©¦ç¯„åœä¸å®Œæ•´

```python
# ä¸å¥½çš„åšæ³• - åªæ¸¬è©¦æ­£å¸¸æƒ…æ³
def test_divide():
    assert divide(10, 2) == 5

# å¥½çš„åšæ³• - æ¸¬è©¦é‚Šç•Œå’Œç•°å¸¸æƒ…æ³
def test_divide_comprehensive():
    # æ­£å¸¸æƒ…æ³
    assert divide(10, 2) == 5
    
    # é‚Šç•Œæƒ…æ³
    assert divide(0, 5) == 0
    assert divide(1, 1) == 1
    
    # ç•°å¸¸æƒ…æ³
    with pytest.raises(ZeroDivisionError):
        divide(10, 0)
    
    # é¡å‹æª¢æŸ¥
    with pytest.raises(TypeError):
        divide("10", 2)
```

---

## ç¸½çµ

### ğŸ¯ å›æ­¸æ¸¬è©¦æˆåŠŸçš„é—œéµ

1. **å…¨é¢è¦†è“‹**: æ¶µè“‹æ ¸å¿ƒåŠŸèƒ½ã€é‚Šç•Œæƒ…æ³ã€éŒ¯èª¤è™•ç†
2. **è‡ªå‹•åŒ–åŸ·è¡Œ**: æ•´åˆåˆ° CI/CD æµç¨‹ä¸­
3. **å¿«é€Ÿåé¥‹**: å„˜æ—©ç™¼ç¾å•é¡Œ
4. **æŒçºŒç¶­è­·**: éš¨è‘—ç³»çµ±è®ŠåŒ–æ›´æ–°æ¸¬è©¦
5. **åœ˜éšŠåƒèˆ‡**: è®“æ‰€æœ‰é–‹ç™¼è€…éƒ½ç†è§£å’ŒåŸ·è¡Œ

### ğŸ“‹ è¡Œå‹•æª¢æŸ¥æ¸…å–®

- [ ] è­˜åˆ¥ç³»çµ±çš„æ ¸å¿ƒåŠŸèƒ½
- [ ] å»ºç«‹æ¸¬è©¦ç’°å¢ƒ
- [ ] ç·¨å¯«åŸºç¤æ¸¬è©¦æ¡ˆä¾‹
- [ ] å¯¦æ–½è‡ªå‹•åŒ–åŸ·è¡Œ
- [ ] æ•´åˆåˆ°é–‹ç™¼æµç¨‹
- [ ] ç›£æ§æ¸¬è©¦è¦†è“‹ç‡
- [ ] å®šæœŸå›é¡§å’Œæ›´æ–°

### ğŸš€ æŒçºŒæ”¹é€²

å›æ­¸æ¸¬è©¦ä¸æ˜¯ä¸€æ¬¡æ€§å·¥ä½œï¼Œè€Œæ˜¯æŒçºŒæ¼”é€²çš„éç¨‹ï¼š

1. **åˆ†æå¤±æ•—æ¨¡å¼**: è¨˜éŒ„å“ªäº›åœ°æ–¹æœ€å®¹æ˜“å‡ºå•é¡Œ
2. **å„ªåŒ–æ¸¬è©¦æ•ˆç‡**: æ¸›å°‘åŸ·è¡Œæ™‚é–“ï¼Œæé«˜åƒ¹å€¼
3. **æ“´å±•æ¸¬è©¦ç¯„åœ**: éš¨è‘—æ–°åŠŸèƒ½æ·»åŠ æ–°çš„æ¸¬è©¦
4. **æå‡æ¸¬è©¦å“è³ª**: è®“æ¸¬è©¦æ›´å¯é ã€æ›´æ˜“ç¶­è­·

è¨˜ä½ï¼š**å¥½çš„å›æ­¸æ¸¬è©¦æ˜¯è»Ÿé«”å“è³ªçš„å®ˆè­·è€…ï¼Œä¹Ÿæ˜¯é–‹ç™¼è€…ä¿¡å¿ƒçš„ä¾†æºï¼** âœ¨